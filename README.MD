# Data Hackathon

## Толкование задания

По заданию по  точке приземления, высоте сброса, массе груза и начальной 
скорости нужно определить координаты x, z точки сброса и угол сброса. 
Однако по имеющиммся данным для любога угла сброса можно определить  координаты точки сброса для попадания
в зану приземления с высокой точностью. Поэтому мы используем угол сброса как параметр нашей программы, а не 
вычисляем его.

## Обозначения

m - масса груза

Fa - вектор аеродинамической силы

V - вектор скорости
 
V_x - x координата вектора скорости, анплогичные обозначения используются и для
других координат и векторов

g - ускорение свободного падения

c - коэффицент пропорциональности между |Fa| и |V|^2

H_треб - высота зоны приземления

H_0 - высота позиции сброса груза
 

## Описание решения
Решение состоит из двух основных частей
 1) Вычисление точки, в которую приземлится груз, 
 с заданными начальной скоростью, углом сброса и точкой сброса (x, H_0, z). 
 2) Вычисление точки, из которой нужно сюросить груз, чтобы он попал в (x, y, z).

### Вычисление точки приземления
На груз действуют сила тяжести и аеродинамическая сила. По данным для отладки можно понять что 
модуль аеродинамической силы зависит следующим образом |Fa| = c*|V|^2, где коэфициент c вычисялется применением
линейной регрессии к |V|^2 и |Fa|. На отладочных данных c =  0.2734.Далее при расчётах будет использоваться эта формула. 
График зависимости:

![Alt text](images/Fa.png?raw=true )

В отличии от этого, для ветров нам не удалось понять зависимость скорости от высоты, поэтому в решении мы
считали, что ветер постоянен между теми высотами, на которых задано его значение.
График зависимости:

![Alt text](images/Wind.png?raw=true )

В решении мы использовали системы уравнений для скорости и координат.

Система уравнений для скорости

V'_x(t) = -c/m|V(t)|V_x(t)

V'_y(t) = -c/m|V(t)|V_y(t) - g

V'_z(t) = -c/m|V(t)|V_z(t)

Уравнение были получены из соображений, что ускорение это производная скорости и ускорение связано
с силой соотношение a = F/m. Ускорение по координатам  x и z обусловлено только аеродинамической
силой, по оси y также влияет сила тяжести. Эту систему уравнений мы решали много раз предсказывая
скорость движения, на протяжении 1 сек, пока высота груза не станет меньше высоты зоны приземления.
Пусть V_clean(i) скорость для i-й секунды без учёта ветра, а  W(i) - скорость ветра.
Тогда имеем такие начальные условие для i-й секунды падения (i >= 0):

V_x(i) = V_clean_x(i) + W_x(i)

V_y(i) = V_clean_y(i)

V_z(i) = V_clean_z(i) + W_y(i)

Система уравнений для координат

s'(t) = V_s(t), где s = x,y  или z

Точку приземления находим решая эти системы уравнений до тех пор пока y(t) >= H_треб.
Где H_треб - высота зоны приземления. 

### Вычисление точки сброса
Если сбрасывая груз из точки (x, H, z) попадает в точку  (a, H_треб, b). То при сбросе из
точки (x+dx, H, z+dz) груз попадает в точку  (a, H_треб, b), поскольку ветры  зависят
только от выстоты. Тогда при сбросе груза из точки (x-a+x, H, z-b+z)=(2x-a, H, 2z-b), он попадёт в
(x, H_треб, z), что нам и трубуется 

### Итоговый алгоритм
1) Используя линейную регрессию для |V|^2 и |Fa| находим коэффициет c в уравнение |Fa|(|V|)
2) Пока в интервале для всех t в интервале [i,i+1) y(t) >= H_треб решаем описанные 
выше системы уравнений. Начальные условия для координат (x, H_0, z). Получаем точку приземления
3) Если на втором шаге была получена точка приземления (a, H_треб, b). Выдать результат алгоритма - 
точку сброса груза  (2x-a, H_0, 2z-b)


## Подготовка к запуску решения
Для запуска решения необходимо подготовить окружение для выполнения кода.

Требования:

- Интерпретатор языка: `Python 3.7`
- Установленные пакеты из списка в `requirements.txt`.
  Пример установки ниже: 
  
  ```bash
  python -m virtualenv .venv
  .venv/Scripts/activate.bat
  pip install -r requirements.txt
  ```

## Запуск решения

Выполнить следующую команду:

```bash
python main.py <X> <Y> <Z> -H <высота> -V <скорость>
```

Подробнее про использование:

```
usage: main.py [-h] [-H H0] [-V V0] [-F F_PATH] [-W W_PATH]
               [-a VELOCITY ANGLE,*] [-m M] [-v V]
               X Y Z

This solver can solve numerically, using differential equations,a high
altitude precision drop. It takes into account mass, different winds, initial
object's velocity and aerodynamic forces to provide accurate results.Results
are validated using high precision simulation.

positional arguments:
  X                    X destination coordinate
  Y                    Y destination coordinate
  Z                    Z destination coordinate

optional arguments:
  -h, --help           show this help message and exit
  -H H0                Drop altitude, m
  -V V0                Initial velocity in XZ space, m/s
  -F F_PATH            Path to a CSV file data with F info
  -W W_PATH            path to a CSV file with winds info
  -a VELOCITY ANGLE,*  angle of drop in radians
  -m M                 Object's mass, kg
  -v V                 Verbosity level for model simulations

```

### Пример запуска решения на данных для отладки

```bash
> python main.py 0 0 0 -V 250 -H 1000

[01:22:30] [INFO]: Trying to detect which type of wind model is needed (calculate deltas in a dataset)...
[01:22:30] [INFO]: Wind dataset will be predicted using dynamic step variation: False
Started solving...
Result position: [-962.21167039 1000.           48.69375408], took: 0:00:00.391501
Verifying accuracy...
Average error: 3.34m
```